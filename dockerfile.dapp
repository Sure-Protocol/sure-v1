FROM node:alpine AS build

WORKDIR /dapp/
COPY lerna.json lerna.json
COPY package.json package.json
COPY tsconfig.json tsconfig.json
COPY packages/app/ packages/app/


RUN apk add git \
    && yarn set version stable \
    && yarn install &> /dev/null  \
    && ls -la \
    && cat package.json \
    && yarn add @craco/craco \
    && yarn build:craco


FROM nginx
COPY --from=build /dapp/packages/app/build/ /usr/share/nginx/html/
